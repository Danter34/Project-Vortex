@model IEnumerable<Vortex.Models.ProductViewModel>
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Quản lý sản phẩm";

    // Gán giá trị mặc định để tránh RuntimeBinderException
    var pageNumber = ViewBag.PageNumber ?? 1;
    var hasPreviousPage = ViewBag.HasPreviousPage ?? false;
    var hasNextPage = ViewBag.HasNextPage ?? false;
    var searchQuery = ViewBag.SearchQuery ?? "";
}

<h2 class="text-white mb-4">Quản lý sản phẩm</h2>

<div class="d-flex justify-content-between mb-3">
    <a asp-action="Create" class="btn btn-primary">+ Thêm sản phẩm</a>

    <form method="get" asp-action="Index" class="d-flex" style="width:300px;">
        <input type="text"
               name="searchQuery"
               class="form-control me-2"
               placeholder="Tìm theo tên..."
               value="@searchQuery" />
        <button type="submit" class="btn btn-info">Tìm</button>
    </form>
</div>

<div class="table-responsive">
    <table class="table table-bordered text-white" style="background: rgba(0,0,0,0.5);">
        <thead style="background: linear-gradient(90deg, #00ffff20, #ff00ff20); color:#00ffff; text-shadow:0 0 5px #00ffff;">
            <tr>
                <th>ID</th>
                <th>Tên</th>
                <th>Giá</th>
                <th>Tồn kho</th>
                <th>Danh mục</th>
                <th>Ảnh</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @if (Model == null || !Model.Any())
            {
                <tr>
                    <td colspan="7" class="text-center text-muted py-3">
                        Không có sản phẩm nào để hiển thị.
                    </td>
                </tr>
            }
            else
            {
                foreach (var item in Model)
                {
                    <tr>
                        <td>@item.Id</td>
                        <td>@item.Title</td>
                        <td>@item.Price.ToString("N0") đ</td>
                        <td>@item.StockQuantity</td>
                        <td>@item.Category?.Name</td>
                        <td>
                            @if (item.Images != null && item.Images.Any())
                            {
                                <img src="@item.Images.First().FilePath"
                                     alt="Ảnh"
                                     style="height:60px;border-radius:5px;" />
                            }
                            else
                            {
                                <span class="text-muted">Không có ảnh</span>
                            }
                        </td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.Id"
                               class="btn btn-warning btn-sm me-1">Sửa</a>
                            <a asp-action="Delete" asp-route-id="@item.Id"
                               class="btn btn-danger btn-sm">Xóa</a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

@if (Model != null && Model.Any())
{
    <div class="d-flex justify-content-center mt-3">
        @if (hasPreviousPage)
        {
            <a class="btn btn-outline-info me-2"
               asp-action="Index"
               asp-route-pageNumber="@(pageNumber - 1)"
               asp-route-searchQuery="@searchQuery">Previous</a>
        }

        <span class="text-white mx-2">Trang @pageNumber</span>

        @if (hasNextPage)
        {
            <a class="btn btn-outline-info"
               asp-action="Index"
               asp-route-pageNumber="@(pageNumber + 1)"
               asp-route-searchQuery="@searchQuery">Next</a>
        }
    </div>
}
